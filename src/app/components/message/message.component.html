<!-- Main Container -->
<div class="flex flex-col md:flex-row h-[calc(80vh-48px)] bg-gray-100">
  <!-- Sidebar -->
  <aside class="w-full md:w-1/4 bg-green-700 text-white p-5 flex flex-col">
    <h2 class="text-2xl font-bold mb-4">Messages</h2>

    <!-- Search Bar -->
    <input
      type="text"
      [(ngModel)]="searchQuery"
      placeholder="Search by name or role..."
      class="w-full p-2 rounded bg-green-600 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 mb-4"
    />

    <!-- Sender/Receiver List -->
    <ul *ngIf="senderReceiverList.length > 0; else noMessages" class="flex-1 overflow-hidden">
      <li
        *ngFor="let item of filteredSenderReceiverList"
        (click)="selectUser(item)"
        [class.bg-green-800]="selectedUser?.messageId === item.messageId"
        class="flex items-center gap-3 p-2 mb-2 rounded cursor-pointer hover:bg-green-800 transition"
      >
        <img
          *ngIf="item.profileImageUrl"
          [src]="`${BASE_URL}/${item.profileImageUrl}`"
          alt="Profile"
          class="w-10 h-10 rounded-full object-cover border-2 border-white"
        />
        <div>
          <div class="font-semibold text-white">{{ item.userName }}</div>
          <div class="text-xs text-gray-200">{{ item.senderRole }} ↔ {{ item.receiverRole }}</div>
        </div>
      </li>
    </ul>

    <ng-template #noMessages>
      <div class="text-sm text-gray-300 mt-4">No messages found.</div>
    </ng-template>
  </aside>

  <!-- Chat Section -->
  <main class="flex-1 flex flex-col">
    <!-- Header -->
<header class="bg-white p-4 shadow flex items-center justify-between border-b">
  <div *ngIf="selectedUser; else noChatSelected" class="flex items-center space-x-4">
    <!-- User Image -->
    <img 
      [src]="`${BASE_URL}/${selectedUser.profileImageUrl}`"
      alt="User" 
      class="w-10 h-10 rounded-full object-cover border" 
    />

    <!-- User Info -->
    <div>
      <h2 class="text-xl font-semibold text-gray-700">
        {{ selectedUser.userName }}
      </h2>
      <span class="text-green-500 text-sm">● Online</span>
    </div>
  </div>

  <ng-template #noChatSelected>
    <h2 class="text-xl font-semibold text-gray-400">Select a conversation</h2>
  </ng-template>
</header>

  <!-- Messages -->
<section
  #messagesContainer
  class="flex-1 bg-white p-6 space-y-4 overflow-y-auto"
  (scroll)="onScroll()"
>
  <ng-container *ngIf="selectedUser; else emptyChat">
    <div *ngFor="let msg of messages">
      <div *ngIf="msg.sendmessage" class="flex justify-end">
        <div class="bg-green-600 text-white px-4 py-2 rounded-lg max-w-xs">
          {{ msg.sendmessage }}
        </div>
      </div>

      <div *ngIf="msg.receivemessage" class="flex justify-start">
        <div class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg max-w-xs">
          {{ msg.receivemessage }}
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #emptyChat>
    <div class="text-center text-gray-400 text-sm mt-10">
      No conversation selected
    </div>
  </ng-template>
</section>



    <!-- Input -->
    <footer class="p-4 bg-gray-50 border-t flex items-center gap-4" *ngIf="selectedUser">
     <input
  type="text"
  placeholder="Type your message..."
  [(ngModel)]="newMessage"
  class="flex-1 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500"
/>
<button
  (click)="onSendMessage()"
  class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
>
  Send
</button>

    </footer>
  </main>
</div>
