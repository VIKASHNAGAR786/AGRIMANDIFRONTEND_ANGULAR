<div class="p-1">
  <h2 class="text-2xl font-bold text-green-700">
    üìä Live Mandi Price Dashboard
  </h2>


  <!-- Filter Form -->
  <div class="bg-white shadow rounded-xl p-1 mt-5">
  <h3 class="text-lg font-semibold text-green-700 mb-4">üîç Filter Mandi Data</h3>

  <form [formGroup]="filterForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <!-- State -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
      <select formControlName="state" class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500">
        <option value="">Select State</option>
        <option *ngFor="let state of states" [value]="state">{{ state }}</option>
      </select>
    </div>

    <!-- District -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">District</label>
      <select formControlName="district" class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500">
        <option value="">Select District</option>
        <option *ngFor="let district of districts" [value]="district">{{ district }}</option>
      </select>
    </div>

    <!-- Commodity -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Commodity</label>
      <input formControlName="commodity" type="text" placeholder="e.g. Wheat" 
        class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500" />
    </div>

    <!-- From Date -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">From Date</label>
      <input formControlName="fromDate" type="date" 
        class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500" />
    </div>

    <!-- To Date -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">To Date</label>
      <input formControlName="toDate" type="date" 
        class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500" />
    </div>

    <!-- Sort Market -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Sort by Market</label>
      <select formControlName="sortMarket" class="border border-gray-300 p-2 rounded-lg w-full focus:ring-2 focus:ring-green-500">
        <option value="asc">Market ‚Üë (A ‚Üí Z)</option>
        <option value="desc">Market ‚Üì (Z ‚Üí A)</option>
      </select>
    </div>

    <!-- Buttons -->
    <div class="md:col-span-3 flex justify-end gap-3 mt-4">
      <button type="button" (click)="filterForm.reset()" 
        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg">
        Reset
      </button>
      <button type="submit" 
        class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg shadow">
        Apply Filters
      </button>
    </div>
  </form>
</div>


  <!-- Loading & Error -->
  <div *ngIf="loading" class="text-blue-500 font-medium mt-2">Loading mandi rates...</div>
  <div *ngIf="error" class="text-red-500 mt-2">{{ error }}</div>

  <!-- Table -->
  <div class="overflow-x-auto mt-4" *ngIf="!loading && records.length > 0">
    <table class="table-auto border-collapse border border-gray-400 w-full">
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="border px-3 py-2">Sr.No</th>
          <th class="border px-3 py-2">State</th>
          <th class="border px-3 py-2">District</th>
          <th class="border px-3 py-2">Market</th>
          <th class="border px-3 py-2">Commodity</th>
          <th class="border px-3 py-2">Variety</th>
          <th class="border px-3 py-2">Arrival Date</th>
          <th class="border px-3 py-2">Min Price</th>
          <th class="border px-3 py-2">Max Price</th>
          <th class="border px-3 py-2">Modal Price</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rec of records; let i = index" class="hover:bg-gray-100 transition">
          <td class="border px-2 py-1">{{ i + 1 }}</td>
          <td class="border px-2 py-1">{{ rec.state }}</td>
          <td class="border px-2 py-1">{{ rec.district }}</td>
          <td class="border px-2 py-1">{{ rec.market }}</td>
          <td class="border px-2 py-1">{{ rec.commodity }}</td>
          <td class="border px-2 py-1">{{ rec.variety }}</td>
          <td class="border px-2 py-1">{{ rec.arrival_Date }}</td>
          <td class="border px-2 py-1">{{ rec.min_Price }}</td>
          <td class="border px-2 py-1">{{ rec.max_Price }}</td>
          <td class="border px-2 py-1">{{ rec.modal_Price }}</td>
        </tr>
      </tbody>
    </table>

    <div class="flex justify-between items-center mt-4">
  <div class="text-sm text-gray-600">
    Total records: {{ totalRowCount }}
  </div>

    <!-- ‚úÖ Pagination Controls -->
    <div class="flex items-center justify-between mt-4">
      <button
        class="bg-gray-300 px-4 py-2 rounded disabled:opacity-50"
        (click)="prevPage()"
        [disabled]="currentPage === 1 || loading">
        Previous
      </button>

      <span class="font-medium">Page {{ currentPage }}</span>

      <button
        class="bg-gray-300 px-4 py-2 rounded"
        (click)="nextPage()"
        [disabled]="records.length < filterForm.value.limit || loading">
        Next
      </button>

      <!-- Page size selector -->
     <select
  [value]="filterForm.value.limit"
  (change)="changePageSize($event)"
  class="border p-2 rounded ml-4">
  <option [value]="10">10</option>
  <option [value]="25">25</option>
  <option [value]="50">50</option>
  <option [value]="100">100</option>
</select>
    </div>
  </div>

  <!-- Empty -->
  <div *ngIf="!loading && records.length === 0 && !error" class="text-gray-500 mt-4">
    No mandi rates found.
  </div>
</div>
