<!-- Navbar Component -->
<nav class="fixed top-0 left-0 w-full z-50 backdrop-blur-xl transition-all duration-500 shadow-lg" [ngStyle]="{
    background: selectedColor,
    backdropFilter: 'blur(15px)',
    WebkitBackdropFilter: 'blur(15px)',
    borderRadius: '0 0 30px 30px'
  }">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Wrapper -->
    <div class="flex items-center py-4">
      <!-- Logo -->
      <a routerLink="/" class="flex items-center gap-3 mr-auto">
        <img src="images/logo.jpg" alt="Logo"
          class="w-10 h-10 object-contain rounded-full drop-shadow-[0_0_6px_rgba(0,255,204,0.8)]" />
        <span
          class="text-white text-xl sm:text-2xl font-extrabold tracking-wide animate-pulse drop-shadow-[0_0_15px_#00ffee]">
          AgriMandi
        </span>
      </a>

      <!-- Hamburger Menu for Mobile -->
      <button class="sm:hidden text-white text-2xl p-2 focus:outline-none focus:ring-2 focus:ring-[#00ffee] rounded-lg"
        aria-label="Toggle menu" (click)="mobileMenuOpen = !mobileMenuOpen">
        <i class="bi" [ngClass]="mobileMenuOpen ? 'bi-x-lg' : 'bi-list'"></i>
      </button>

      <!-- Desktop Menu -->
      <div class="hidden sm:flex sm:items-center gap-6 flex-1 justify-end">
        <!-- Search -->
        <div class="w-full max-w-md">
          <input type="text" placeholder="Search products, buyers..."
            class="w-full px-4 py-2 rounded-full bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ffee] shadow-inner" />
        </div>

        <!-- Notifications -->
        <div *ngIf="isLoggedIn" class="relative">
          <a [routerLink]="['/notifications']">
            <button class="p-2 rounded-full hover:bg-white/10 transition relative">
              <i class="bi bi-bell-fill text-white text-xl"></i>
              <span *ngIf="notificationCount > 0"
                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full px-1.5 py-0.5 shadow-md">
                {{ notificationCount }}
              </span>
            </button>
          </a>
        </div>

        <!-- User or Auth Buttons -->
        <div class="relative user-dropdown" *ngIf="isLoggedIn; else authBtns">
          <!-- Profile Button -->
          <button (click)="toggleUserMenu()"
            class="flex items-center gap-2 px-3 py-2 rounded-full bg-white/10 hover:bg-white/20 transition duration-300 focus:outline-none backdrop-blur-md border border-white/20 shadow-md">
            <img [src]="profileImageUrl || defaultProfileImage" alt="User Avatar"
              class="w-10 h-10 rounded-full border-2 border-cyan-300 shadow-inner ring-2 ring-white/30" />
            <span
              class="text-white font-medium hidden sm:inline-block truncate max-w-[120px] tracking-wide drop-shadow-sm">{{
              username || 'User' }}</span>
            <i class="bi bi-caret-down-fill text-white text-sm drop-shadow"></i>
          </button>

          <!-- Dropdown Menu -->
          <div *ngIf="showUserMenu"
            class="absolute right-0 mt-3 w-56 bg-white rounded-xl shadow-xl z-50 py-2 animate-fade-in-down border border-gray-200">
            <ng-container *ngFor="let item of dropdownLinks">
              <ng-container *ngIf="item.showIf()">
                <!-- Normal Link -->
                <a *ngIf="!item.isButton" [routerLink]="item.routerLink"
                  class="block px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-black transition duration-150 flex items-center gap-2">
                  <i class="bi text-base" [ngClass]="item.icon"></i>
                  <span class="text-sm font-medium">{{ item.label }}</span>
                </a>

                <!-- Button Link -->
                <button *ngIf="item.isButton" (click)="item.click?.($event)"
                  class="w-full text-left px-4 py-3 hover:bg-gray-100 hover:text-black transition duration-150 flex items-center gap-2"
                  [ngClass]="item.class || 'text-gray-700'">
                  <i class="bi text-base" [ngClass]="item.icon"></i>
                  <span class="text-sm font-medium">{{ item.label }}</span>
                </button>
              </ng-container>
            </ng-container>
          </div>
        </div>



        <ng-template #authBtns>
          <div class="flex gap-3">
            <a routerLink="/auth/login"
              class="px-4 py-2 border-2 border-[#00ffee] text-[#00ffee] font-medium rounded-full hover:bg-[#00ffee] hover:text-black transition">
              Login
            </a>
            <a routerLink="/auth/signup"
              class="px-4 py-2 bg-gradient-to-r from-[#00ffcc] to-[#00cc99] text-white font-medium rounded-full hover:shadow-[0_0_20px_#00ffee] transition">
              Sign Up
            </a>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div *ngIf="mobileMenuOpen" class="sm:hidden flex flex-col gap-4 pb-4 animate-fade-in-down">
      <!-- Search Box -->
      <input type="text" placeholder="Search..."
        class="w-full px-4 py-2 rounded-full bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#00ffee] shadow-inner placeholder-gray-500" />

      <!-- Mobile User / Auth Section -->
      <div class="flex justify-between items-center">

        <ng-container *ngIf="isLoggedIn; else mobileAuthBtns">
    <!-- Tappable Avatar -->
    <div class="relative user-dropdown">
      <button (click)="toggleUserMenu()" class="flex items-center gap-2 rounded-full px-2 py-1 hover:bg-white/10 transition duration-300 focus:outline-none">
        <img [src]="profileImageUrl || defaultProfileImage"
             class="w-9 h-9 rounded-full border-2 border-[#00ffee] shadow-md" />
        <span class="text-white font-medium truncate max-w-[100px]">{{ username || 'User' }}</span>
        <i class="bi bi-caret-down-fill text-white text-sm"></i>
      </button>

      <!-- Dropdown Menu (Mobile) -->
      <div *ngIf="showUserMenu"
           class="absolute right-0 mt-3 w-56 bg-white rounded-xl shadow-xl z-50 py-2 animate-fade-in-down border border-gray-200">
        <ng-container *ngFor="let item of dropdownLinks">
          <ng-container *ngIf="item.showIf()">
            <!-- Normal Link -->
            <a *ngIf="!item.isButton" [routerLink]="item.routerLink"
               class="w-full px-4 py-3 text-gray-700 hover:bg-gray-100 hover:text-black transition duration-150 flex items-center gap-2">
              <i class="bi text-base" [ngClass]="item.icon"></i>
              <span class="text-sm font-medium">{{ item.label }}</span>
            </a>

            <!-- Button Link -->
            <button *ngIf="item.isButton" (click)="item.click?.($event)"
                    class="w-full text-left px-4 py-3 hover:bg-gray-100 hover:text-black transition duration-150 flex items-center gap-2"
                    [ngClass]="item.class || 'text-gray-700'">
              <i class="bi text-base" [ngClass]="item.icon"></i>
              <span class="text-sm font-medium">{{ item.label }}</span>
            </button>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </ng-container>
        <!-- Auth Buttons -->
        <ng-template #mobileAuthBtns>
          <div class="flex gap-2 w-full">
            <a routerLink="/auth/login"
              class="flex-1 text-center px-4 py-2 border border-[#00ffee] text-[#00ffee] rounded-full">
              Login
            </a>
            <a routerLink="/auth/signup"
              class="flex-1 text-center px-4 py-2 bg-gradient-to-r from-[#00ffcc] to-[#00cc99] text-white rounded-full">
              Sign Up
            </a>
          </div>
        </ng-template>
      </div>
    </div>

  </div>
</nav>