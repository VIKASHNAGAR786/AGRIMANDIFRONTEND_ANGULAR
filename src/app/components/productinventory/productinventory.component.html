<!-- Loader -->
<div *ngIf="loading" 
     class="fixed inset-0 flex items-center justify-center bg-gradient-to-br from-green-900/80 via-black/80 to-green-950/80 backdrop-blur-md z-50">
  <div class="flex flex-col items-center space-y-8">

    <!-- Inventory Box Spinner -->
    <div class="relative">
      <!-- Rotating outer ring -->
      <div class="w-24 h-24 rounded-full border-4 border-transparent border-t-green-400 animate-spin"></div>

      <!-- Center box (represents product crate) -->
      <div class="absolute inset-4 bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 7l9-4 9 4-9 4-9-4zM3 17l9 4 9-4M3 12l9 4 9-4" />
        </svg>
      </div>
    </div>

    <!-- Loading Message -->
    <p class="text-green-100 text-xl font-bold tracking-wide animate-pulse">
      üì¶ Loading your inventory...
    </p>

    <!-- Progress Bar styled as stock level -->
    <div class="w-64 h-3 bg-green-900 rounded-full overflow-hidden shadow-inner">
      <div class="h-full bg-gradient-to-r from-green-400 to-green-600 animate-[progressFill_2s_infinite]"></div>
    </div>
  </div>
</div>

<!-- Tailwind Custom Animation -->
<style>
@keyframes progressFill {
  0% { width: 0%; }
  50% { width: 70%; }
  100% { width: 100%; }
}
</style>




<!-- Product List View -->
<div *ngIf="!loading && !selectedproduct && products.length > 0" class="w-full px-4 my-5">
  <!-- Product Filter -->
  <div class="bg-white dark:bg-gray-900 shadow-lg border border-gray-200 dark:border-gray-800 rounded-3xl p-6 mb-8">
    <h3 class="text-2xl font-semibold text-gray-800 dark:text-white mb-6">üîç Filter Products</h3>

    <form (ngSubmit)="loadAllProducts(filterForm)"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-6" autocomplete="off">

      <!-- Product Name -->
      <div>
        <label for="name" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-box-seam mr-2"></i>Product Name
        </label>
        <input type="text" id="name" name="name" [(ngModel)]="filterForm.Name"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition"
          placeholder="Enter product name" />
      </div>

      <!-- Category -->
      <div>
        <label for="category" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-tags mr-2"></i>Category
        </label>
        <input type="text" id="category" name="category" [(ngModel)]="filterForm.Category"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition"
          placeholder="Enter category" />
      </div>

      <!-- Location -->
      <div>
        <label for="location" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-geo-alt mr-2"></i>Location
        </label>
        <input type="text" id="location" name="location" [(ngModel)]="filterForm.Location"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition"
          placeholder="Enter location" />
      </div>

      <!-- Availability -->
      <div>
        <label for="availability" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-check-circle mr-2"></i>Availability
        </label>
        <select id="availability" name="availability" [(ngModel)]="filterForm.Availability"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition">
          <option [ngValue]="null">-- All --</option>
          <option [value]="true">Available</option>
          <option [value]="false">Not Available</option>
        </select>
      </div>

      <!-- Min Price -->
      <div>
        <label for="minPrice" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-cash-coin mr-2"></i>Min Price
        </label>
        <input type="number" id="minPrice" name="minPrice" [(ngModel)]="filterForm.MinPrice"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition"
          placeholder="Minimum price" />
      </div>

      <!-- Max Price -->
      <div>
        <label for="maxPrice" class="block text-gray-700 dark:text-gray-300 mb-2 font-medium">
          <i class="bi bi-cash-stack mr-2"></i>Max Price
        </label>
        <input type="number" id="maxPrice" name="maxPrice" [(ngModel)]="filterForm.MaxPrice"
          class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-green-500 transition"
          placeholder="Maximum price" />
      </div>

      <!-- Search Button -->
      <div class="flex items-end">
        <button type="submit"
          class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-semibold shadow transition duration-300">
          <i class="bi bi-search mr-2"></i>Search
        </button>
      </div>

      <!-- Reset Button -->
      <div class="flex items-end">
        <button type="button" (click)="resetFilters()"
          class="w-full bg-red-50 text-red-600 hover:bg-red-100 border border-red-300 px-6 py-3 rounded-xl font-semibold shadow transition duration-300">
          <i class="bi bi-arrow-counterclockwise mr-2"></i>Reset
        </button>
      </div>

    </form>
  </div>



  <div class="row g-4">
    <div *ngFor="let product of products" class="col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm">
        <!-- <img [src]="product.imageUrl || 'https://via.placeholder.com/150'" class="card-img-top img-fluid" [alt]="product.name"> -->
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-truncate" title="{{ product.name }}">{{ product.name }}</h5>
          <p class="card-text text-muted small">{{ product.description | slice:0:60 }}...</p>

          <div class="mb-2">
            <span class="badge bg-primary">{{ product.category! | translate}}</span>
            <span class="badge bg-success">{{ product.grade! | translate }}</span>
          </div>

          <ul class="list-group list-group-flush mb-2 small">
            <li class="list-group-item px-0 py-1"><strong>Qty:</strong> {{ product.quantity }} {{ product.unit! | translate}}</li>
            <li class="list-group-item px-0 py-1"><strong>‚Çπ/Unit:</strong> ‚Çπ{{ product.pricePerUnit  }}</li>
            <li class="list-group-item px-0 py-1"><strong>Location:</strong> {{ product.location }}</li>
            <li class="list-group-item px-0 py-1"><strong>Harvest:</strong> {{ product.harvestDate | date }}</li>
          </ul>

          <div class="mt-auto d-grid gap-2">
            <button class="btn btn-outline-primary btn-sm" (click)="buyProduct()">Contact Farmer</button>
            <button class="btn btn-outline-secondary btn-sm" (click)="viewDetails(product)">Detail View</button>
            <button class="btn btn-success btn-sm" (click)="buyProduct()">Buy</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>