<!-- Loader -->
<div *ngIf="loading"
  class="fixed inset-0 flex items-center justify-center bg-gradient-to-br from-green-900/80 via-black/80 to-green-950/80 backdrop-blur-md z-50">
  <div class="flex flex-col items-center space-y-8">

    <!-- Inventory Box Spinner -->
    <div class="relative">
      <!-- Rotating outer ring -->
      <div class="w-24 h-24 rounded-full border-4 border-transparent border-t-green-400 animate-spin"></div>

      <!-- Center box (represents product crate) -->
      <div
        class="absolute inset-4 bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white animate-bounce" fill="none"
          viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 7l9-4 9 4-9 4-9-4zM3 17l9 4 9-4M3 12l9 4 9-4" />
        </svg>
      </div>
    </div>

    <!-- Loading Message -->
    <p class="text-green-100 text-xl font-bold tracking-wide animate-pulse">
      üì¶ Loading your inventory...
    </p>

    <!-- Progress Bar styled as stock level -->
    <div class="w-64 h-3 bg-green-900 rounded-full overflow-hidden shadow-inner">
      <div class="h-full bg-gradient-to-r from-green-400 to-green-600 animate-[progressFill_2s_infinite]"></div>
    </div>
  </div>
</div>

<!-- Tailwind Custom Animation -->
<style>
  @keyframes progressFill {
    0% {
      width: 0%;
    }

    50% {
      width: 70%;
    }

    100% {
      width: 100%;
    }
  }
</style>



<!-- Single Product Detail View -->
<div *ngIf="!loading && selectedproduct" class="container my-10">
  <div class="card shadow-xl rounded-3xl overflow-hidden border-0">
    <div class="row g-0">

      <!-- Product Image -->
      <div class="col-md-5">
        <img [src]="selectedproduct.imageUrl || 'images/defaultproduct.webp'" class="img-fluid h-100 w-100 object-cover"
          [alt]="selectedproduct.name">
      </div>

      <!-- Product Content -->
      <div class="col-md-7 p-6">
        <div class="card-body">

          <!-- Title & Price Highlight -->
          <div class="flex items-center justify-between mb-4">
            <h1 class="text-3xl font-bold text-gray-900">{{ selectedproduct.name }}</h1>
            <span class="text-2xl font-extrabold text-green-700">‚Çπ{{ selectedproduct.pricePerUnit }}/{{
              selectedproduct.unit! | translate}}</span>
          </div>
          <p class="text-gray-600 mb-4">{{ selectedproduct.description }}</p>

          <!-- Badges -->
          <div class="flex flex-wrap gap-2 mb-6">
            <span class="px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-700">{{ selectedproduct.category! | translate}}</span>
            <span class="px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-700">{{ selectedproduct.type! | translate}}</span>
            <span class="px-3 py-1 rounded-full text-sm bg-indigo-100 text-indigo-700">{{ selectedproduct.variety! | translate}}</span>
            <span class="px-3 py-1 rounded-full text-sm bg-green-100 text-green-700">{{ selectedproduct.grade! | translate}}</span>
            <span class="px-3 py-1 rounded-full text-sm"
              [ngClass]="selectedproduct.availability ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'">
              {{ selectedproduct.availability ? 'In Stock' : 'Out of Stock' }}
            </span>
          </div>

          <!-- Stylish Tabs -->
          <ul class="flex border-b mb-6">
            <li *ngFor="let tab of tabs" class="mr-2">
              <button (click)="setActiveTab(tab.id)"
                class="inline-flex items-center px-5 py-3 rounded-t-xl font-medium transition" [ngClass]="activeTab === tab.id 
        ? 'bg-green-100 text-green-700 border-b-2 border-green-600' 
        : 'text-gray-600 hover:text-green-600 hover:bg-green-50'">
                <i class="bi" [ngClass]="tab.icon + ' mr-2'"></i> {{ tab.label | translate}}
              </button>
            </li>
          </ul>

          <!-- Overview -->
          <div class="tab-content p-3 bg-gray-50 rounded-xl shadow-sm">
            <div *ngIf="activeTab === 'overview'">
              <div class="tab-pane fade show active" id="overview">
                <ul class="space-y-2 text-gray-700">
                  <li><strong>{{'Quantity' | translate}}:</strong> {{ selectedproduct.quantity }} {{ selectedproduct.unit! | translate}}</li>
                  <li><strong>{{'Total Price' | translate}}:</strong> <span class="text-green-700 font-bold">‚Çπ{{
                      selectedproduct.totalPrice
                      }}</span></li>
                  <li><strong>{{'Status' | translate}}:</strong> {{ selectedproduct.status }}</li>
                  <li><strong>{{'Harvest Date' | translate}}:</strong> {{ selectedproduct.harvestDate | date }}</li>
                  <li><strong>{{'Expiry Date' | translate}}:</strong> {{ selectedproduct.expiryDate | date }}</li>
                  <li><strong>{{'Location' | translate}}:</strong> {{ selectedproduct.location }}</li>
                </ul>
              </div>
            </div>

            <!-- Farming content -->
            <div *ngIf="activeTab === 'farming'">
              <ul class="space-y-2 text-gray-700">
                <li><strong>{{'Storage Condition' | translate}}:</strong> {{ selectedproduct.storageCondition }}</li>
                <li><strong>{{'Packaging Type' | translate}}:</strong> {{ selectedproduct.packagingType }}</li>
                <li><strong>{{'Certification' | translate}}:</strong> {{ selectedproduct.certification }}</li>
                <li><strong>{{'Farming Type' | translate}}:</strong> {{ selectedproduct.farmingType }}</li>
                <li><strong>{{'Land Area' | translate}}:</strong> {{ selectedproduct.landArea }} acres</li>
              </ul>
            </div>

            <!-- Farmer content -->
            <div *ngIf="activeTab === 'farmer'">
              <ul class="space-y-2 text-gray-700">
                <li><strong>{{'Name' | translate}}:</strong> {{ selectedproduct.farmerName }}</li>
                <li><strong>{{'Email' | translate}}:</strong> {{ selectedproduct.farmerEmail }}</li>
                <li><strong>{{'Phone' | translate}}:</strong> {{ selectedproduct.farmerPhone }}</li>
                <li><strong>{{'Address' | translate}}:</strong> {{ selectedproduct.farmerAddress }}</li>
                <li><strong>{{'State' | translate}}:</strong> {{ selectedproduct.state }}</li>
                <li><strong>{{'Postal Code' | translate}}:</strong> {{ selectedproduct.postalCode }}</li>
              </ul>
            </div>
          </div>

          <!-- Meta Info (Single Row) -->
          <div
            class="mt-6 p-4 rounded-xl bg-green-50 border border-green-200 shadow-sm flex flex-wrap items-center justify-between text-sm">

            <!-- Listed On -->
            <div class="flex items-center space-x-2 text-green-700 font-medium">
              <i class="bi bi-calendar-plus"></i>
              <span>Listed On:</span>
              <span class="text-gray-700 font-normal">
                {{ selectedproduct.addedDate | date:'fullDate' }}
              </span>
            </div>

            <!-- Last Updated -->
            <div class="flex items-center space-x-2 text-blue-700 font-medium">
              <i class="bi bi-arrow-repeat"></i>
              <span>Last Updated:</span>
              <span class="text-gray-700 font-normal">
                {{ selectedproduct.updatedDate | date:'fullDate' }}
              </span>
            </div>

          </div>

          <!-- Action Buttons -->
          <div class="flex flex-wrap gap-3 mt-5">
            <button (click)="buyProduct()" class="btn btn-success flex items-center gap-2 px-4 py-2">
              <i class="bi bi-cart-check"></i> Buy Now
            </button>
            <button class="btn btn-outline-primary flex items-center gap-2 px-4 py-2" (click)="toggleContactForm()">
              <i class="bi bi-envelope"></i> Contact Farmer
            </button>
            <button class="btn btn-outline-secondary flex items-center gap-2 px-4 py-2"
              (click)="viewProductPdf(selectedproduct.productid)">
              <i class="bi bi-file-earmark-arrow-down"></i> PDF
            </button>
            <button class="btn btn-outline-danger flex items-center gap-2 px-4 py-2" (click)="goBackToList()">
              <i class="bi bi-arrow-left"></i> Back
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>


  <div *ngIf="showContactForm"
     class="fixed inset-0 z-40 flex items-center justify-center 
            bg-gradient-to-br from-black/60 via-green-950/50 to-black/60 
            backdrop-blur-md transition-opacity duration-300 animate-fadeBackdrop"
     (click)="showContactForm = false">
</div>


<!-- Modal -->
<div *ngIf="showContactForm"
     class="fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
            bg-white rounded-2xl shadow-2xl border border-green-200 max-w-lg w-full
            p-6 transition duration-300 ease-out scale-100 opacity-100"
     (click)="$event.stopPropagation()">

     <!-- Header -->
<div class="flex justify-between items-center mb-6 border-b border-green-100 pb-3 relative">
  <!-- Icon + Title -->
  <div class="flex items-center gap-3 animate-slideInLeft">
    <div class="bg-green-100 p-2 rounded-full shadow-sm">
      <svg class="w-6 h-6 text-green-700" fill="none" stroke="currentColor" stroke-width="2"
           viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M8 10h.01M12 14h.01M16 10h.01M21 16V8a2 2 0 00-2-2h-3.586a1 1 0 01-.707-.293l-2.414-2.414a1 1 0 00-.707-.293H7a2 2 0 00-2 2v12a2 2 0 002 2h10" />
      </svg>
    </div>
    <h2 class="text-xl font-bold text-green-800 tracking-wide">
      ‚úâÔ∏è Send Message to Farmer
    </h2>
  </div>

  <!-- Close Button -->
  <button (click)="showContactForm = false"
          class="absolute right-0 top-0 text-gray-400 hover:text-red-600 transition-all text-2xl font-bold leading-none px-2 py-1 rounded-full hover:bg-red-100">
    &times;
  </button>
</div>


  <!-- Message Form -->
  <form (ngSubmit)="sendMessage()" class="space-y-4">
    <div>
      <div *ngIf="farmermail_for_contact" class="text-sm text-gray-600 bg-gray-100 p-2 rounded-md shadow-sm">
        You are messaging to <strong>{{ farmermail_for_contact }}</strong>
      </div>
      <textarea [(ngModel)]="message.MessageText"
                name="MessageText"
                id="MessageText"
                placeholder="Write your message to the farmer here..."
                required
                rows="5"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition shadow-sm"></textarea>
    </div>

    <button type="submit"
            class="w-full flex justify-center items-center gap-2 bg-green-600 text-white font-semibold py-2.5 rounded-lg hover:bg-green-700 transition duration-300 shadow-md">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
           viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-18 8h18a2 2 0 002-2V6a2 2 0 00-2-2H3a2 2 0 00-2 2v8a2 2 0 002 2z"/>
      </svg>
      Send Message
    </button>
  </form>
</div>
</div>