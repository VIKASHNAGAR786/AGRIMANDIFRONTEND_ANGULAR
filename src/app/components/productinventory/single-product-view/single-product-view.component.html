
<!-- Loader -->
<div *ngIf="loading" 
     class="fixed inset-0 flex items-center justify-center bg-gradient-to-br from-green-900/80 via-black/80 to-green-950/80 backdrop-blur-md z-50">
  <div class="flex flex-col items-center space-y-8">

    <!-- Inventory Box Spinner -->
    <div class="relative">
      <!-- Rotating outer ring -->
      <div class="w-24 h-24 rounded-full border-4 border-transparent border-t-green-400 animate-spin"></div>

      <!-- Center box (represents product crate) -->
      <div class="absolute inset-4 bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 7l9-4 9 4-9 4-9-4zM3 17l9 4 9-4M3 12l9 4 9-4" />
        </svg>
      </div>
    </div>

    <!-- Loading Message -->
    <p class="text-green-100 text-xl font-bold tracking-wide animate-pulse">
      ðŸ“¦ Loading your inventory...
    </p>

    <!-- Progress Bar styled as stock level -->
    <div class="w-64 h-3 bg-green-900 rounded-full overflow-hidden shadow-inner">
      <div class="h-full bg-gradient-to-r from-green-400 to-green-600 animate-[progressFill_2s_infinite]"></div>
    </div>
  </div>
</div>

<!-- Tailwind Custom Animation -->
<style>
@keyframes progressFill {
  0% { width: 0%; }
  50% { width: 70%; }
  100% { width: 100%; }
}
</style>



<!-- Single Product Detail View -->
<div *ngIf="!loading && selectedproduct" class="container my-8">
  <div class="card shadow-xl rounded-3xl overflow-hidden border-0">
    <div class="row g-0">
      
      <!-- Product Image -->
      <div class="col-md-5">
        <img [src]="selectedproduct.imageUrl || 'images/defaultproduct.webp'"
          class="img-fluid h-100 w-100 object-cover"
          [alt]="selectedproduct.name">
      </div>

      <!-- Product Details -->
      <div class="col-md-7 p-5">
        <div class="card-body">
          <!-- Title -->
          <h1 class="text-3xl font-bold text-gray-900 mb-3">{{ selectedproduct.name }}</h1>
          <p class="text-gray-600 leading-relaxed mb-4">{{ selectedproduct.description }}</p>

          <!-- Badges -->
          <div class="flex flex-wrap gap-2 mb-4">
            <span class="px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-700">{{ selectedproduct.category }}</span>
            <span class="px-3 py-1 rounded-full text-sm bg-green-100 text-green-700">{{ selectedproduct.grade }}</span>
            <span class="px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-700">{{ selectedproduct.status }}</span>
          </div>

          <!-- Product Info -->
          <div class="bg-gray-50 rounded-xl p-4 shadow-sm mb-5">
            <ul class="space-y-2 text-gray-700">
              <li><strong>Quantity:</strong> {{ selectedproduct.quantity }} {{ selectedproduct.unit }}</li>
              <li><strong>Price per Unit:</strong> <span class="text-green-600 font-semibold">â‚¹{{ selectedproduct.pricePerUnit }}</span></li>
              <li><strong>Total Price:</strong> <span class="text-green-700 font-bold text-lg">â‚¹{{ selectedproduct.totalPrice }}</span></li>
              <li><strong>Location:</strong> {{ selectedproduct.location }}</li>
              <li><strong>Harvest Date:</strong> {{ selectedproduct.harvestDate | date }}</li>
            </ul>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-wrap gap-3">
            <button (click)="buyProduct()"
            class="btn btn-success flex items-center gap-2 px-4 py-2">
              <i class="bi bi-cart-check"></i> Buy Now
            </button>
            <button class="btn btn-outline-primary flex items-center gap-2 px-4 py-2" (click)="toggleContactForm()">
              <i class="bi bi-envelope"></i> Contact Farmer
            </button>
            <button class="btn btn-outline-secondary flex items-center gap-2 px-4 py-2" (click)="viewProductPdf(selectedproduct.productid)">
              <i class="bi bi-file-earmark-arrow-down"></i> PDF
            </button>
            <button class="btn btn-outline-danger flex items-center gap-2 px-4 py-2" (click)="goBackToList()">
              <i class="bi bi-arrow-left"></i> Back
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Modal -->
  <div *ngIf="showContactForm" class="fixed inset-0 z-40 flex items-center justify-center 
    bg-black/60 backdrop-blur-sm" (click)="showContactForm = false">
    
    <div (click)="$event.stopPropagation()" 
      class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 relative animate-fadeIn">
      
      <!-- Close Button -->
      <button (click)="showContactForm = false"
        class="absolute right-3 top-3 text-gray-400 hover:text-red-600 text-2xl font-bold">
        &times;
      </button>

      <!-- Header -->
      <h2 class="text-xl font-bold text-green-700 mb-4 flex items-center gap-2">
        <i class="bi bi-chat-dots-fill"></i> Message Farmer
      </h2>

      <!-- Form -->
      <form (ngSubmit)="sendMessage()" class="space-y-4">
        <div *ngIf="farmermail_for_contact" class="text-sm text-gray-600 bg-gray-50 p-2 rounded-md">
          Messaging <strong>{{ farmermail_for_contact }}</strong>
        </div>
        <textarea [(ngModel)]="message.MessageText" name="MessageText" required rows="5"
          class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 shadow-sm"
          placeholder="Write your message..."></textarea>

        <button type="submit"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2.5 rounded-lg shadow-md flex justify-center items-center gap-2">
          <i class="bi bi-send-fill"></i> Send
        </button>
      </form>
    </div>
  </div>
</div>
