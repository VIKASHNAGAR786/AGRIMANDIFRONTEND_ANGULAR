import{a as $}from"./chunk-7BWKNZ47.js";import{b as Q,d as G,i as k,t as P}from"./chunk-Q3FGXIL4.js";import{a as W}from"./chunk-NLJOITTN.js";import"./chunk-6ND7BYCL.js";import"./chunk-GUTKJVVT.js";import{l as F,m as N,s as D}from"./chunk-ABM62O6S.js";import{Ab as h,Bb as j,Db as S,Eb as E,Fb as I,Ha as w,La as r,Qa as b,Qb as C,Va as T,_a as d,fb as l,ga as p,gb as U,ha as f,i as v,ib as s,jb as i,lb as A,mb as V,nb as x,qb as _,rb as c,ub as R,vb as B,w as M,wb as L,xb as y,yb as g,zb as O}from"./chunk-KOBZJFWX.js";var q=["messagesContainer"];function z(t,n){if(t&1){let e=x();s(0,"li",17),_("click",function(){let a=p(e).$implicit,m=c(2);return f(m.selectUser(a))}),s(1,"img",18),_("error",function(a){p(e);let m=c(2);return f(m.onImageError(a))}),i(),s(2,"div")(3,"div",19),g(4),i(),s(5,"div",20),g(6),i()()()}if(t&2){let e=n.$implicit,o=c(2);U("bg-green-800",(o.selectedUser==null?null:o.selectedUser.messageId)===e.messageId),r(),l("src",e.profileImageUrl?`${o.BASE_URL}/${e.profileImageUrl}`:"images/profile.jpeg",w),r(3),O(e.userName),r(2),j("",e.senderRole," \u2194 ",e.receiverRole,"")}}function J(t,n){if(t&1&&(s(0,"ul",15),d(1,z,7,6,"li",16),i()),t&2){let e=c();r(),l("ngForOf",e.filteredSenderReceiverList)}}function K(t,n){t&1&&(s(0,"div",21),g(1,"No messages found."),i())}function X(t,n){if(t&1){let e=x();s(0,"div",22)(1,"img",18),_("error",function(a){p(e);let m=c();return f(m.onImageError(a))}),i(),s(2,"div")(3,"h2",23),g(4),i(),s(5,"span",24),g(6,"\u25CF Online"),i()()()}if(t&2){let e=c();r(),l("src",e.selectedUser.profileImageUrl?`${e.BASE_URL}/${e.selectedUser.profileImageUrl}`:"assets/profile.jpeg",w),r(3),h(" ",e.selectedUser.userName," ")}}function Y(t,n){t&1&&(s(0,"h2",25),g(1,"Select a conversation"),i())}function Z(t,n){t&1&&(s(0,"div",29)(1,"div",30)(2,"span",31),g(3,"Loading..."),i()()())}function ee(t,n){t&1&&(s(0,"div",32),g(1," No messages "),i())}function te(t,n){if(t&1&&(s(0,"div",36)(1,"div",37),g(2),i()()),t&2){let e=c().$implicit;r(2),h(" ",e.message," ")}}function ne(t,n){if(t&1&&(s(0,"div",38)(1,"div",39),g(2),i()()),t&2){let e=c().$implicit;r(2),h(" ",e.message," ")}}function ie(t,n){if(t&1&&(s(0,"div"),d(1,te,3,1,"div",34)(2,ne,3,1,"div",35),i()),t&2){let e=n.$implicit;r(),l("ngIf",e.isSentByCurrentUser),r(),l("ngIf",!e.isSentByCurrentUser)}}function se(t,n){if(t&1&&(s(0,"div"),d(1,ie,3,2,"div",33),i()),t&2){let e=c(2);r(),l("ngForOf",e.messages)}}function re(t,n){if(t&1&&(A(0),d(1,Z,4,0,"div",26)(2,ee,2,0,"div",27)(3,se,2,1,"div",28),V()),t&2){let e=c();r(),l("ngIf",e.loadingMessages),r(),l("ngIf",!e.loadingMessages&&e.messages.length===0),r(),l("ngIf",!e.loadingMessages&&e.messages.length>0)}}function oe(t,n){t&1&&(s(0,"div",40),g(1,"Select a user to start chatting"),i())}function ae(t,n){if(t&1){let e=x();s(0,"footer",41)(1,"input",42),I("ngModelChange",function(a){p(e);let m=c();return E(m.newMessage,a)||(m.newMessage=a),f(a)}),i(),s(2,"button",43),_("click",function(){p(e);let a=c();return f(a.onSendMessage())}),g(3,` Send
`),i()()}if(t&2){let e=c();r(),S("ngModel",e.newMessage)}}var H=class t{constructor(n){this.messageService=n}messagesContainer;autoScroll=!0;senderReceiverList=[];selectedUser=null;messages=[];newMessage="";searchQuery="";sidebarOpen=!0;BASE_URL=W.BASE_URL;loadingMessages=!1;ngOnInit(){return v(this,null,function*(){yield this.loadSenderReceiverData()})}ngAfterViewInit(){this.scrollToBottom()}loadSenderReceiverData(){return v(this,null,function*(){try{this.senderReceiverList=yield M(this.messageService.GetAllSenderAndReceiverData())}catch(n){console.error("Error loading sender/receiver list",n)}})}selectUser(n){return v(this,null,function*(){if(this.selectedUser?.useridformessage!==n.useridformessage){this.selectedUser=n,this.loadingMessages=!0,this.messages=[];try{this.messages=yield M(yield this.messageService.GetAllMessageUserBy(n.useridformessage)),yield this.onMessagesUpdated()}catch(e){console.error("Error loading messages for user",e)}finally{this.loadingMessages=!1,yield this.onMessagesUpdated()}}})}get filteredSenderReceiverList(){if(!this.searchQuery.trim())return this.senderReceiverList;let n=this.searchQuery.toLowerCase();return this.senderReceiverList.filter(e=>e.userName?.toLowerCase().includes(n))}onMessagesUpdated(){this.autoScroll&&this.scrollToBottom()}scrollToBottom(){try{requestAnimationFrame(()=>{this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight})}catch(n){console.error("Scroll failed",n)}}onScroll(){let n=this.messagesContainer.nativeElement,e=n.scrollHeight-n.scrollTop-n.clientHeight<50;this.autoScroll=e}onSendMessage(){if(!this.newMessage.trim()||!this.selectedUser)return;let n={mainuserid:this.selectedUser.useridformessage,messageText:this.newMessage};this.messageService.sendMessage(n).subscribe(e=>{e&&(this.messages.push({message:this.newMessage,messageid:0,isSentByCurrentUser:!0}),this.newMessage="")})}onImageError(n){let e=n.target;e.src="images/profile.jpeg"}static \u0275fac=function(e){return new(e||t)(b($))};static \u0275cmp=T({type:t,selectors:[["app-message"]],viewQuery:function(e,o){if(e&1&&R(q,5),e&2){let a;B(a=L())&&(o.messagesContainer=a.first)}},decls:19,vars:8,consts:[["noMessages",""],["noChatSelected",""],["messagesContainer",""],["emptyChat",""],[1,"flex","flex-col","md:flex-row","h-[calc(80vh-48px)]","bg-gray-100"],[1,"w-full","md:w-1/4","bg-green-700","text-white","p-5","flex","flex-col"],[1,"text-2xl","font-bold","mb-4"],["type","text","placeholder","Search by name or role...",1,"w-full","p-2","rounded","bg-green-600","text-white","placeholder-gray-300","focus:outline-none","focus:ring-2","focus:ring-yellow-300","mb-4",3,"ngModelChange","ngModel"],["class","flex-1 overflow-hidden",4,"ngIf","ngIfElse"],[1,"flex-1","flex","flex-col"],[1,"bg-white","p-4","shadow","flex","items-center","justify-between","border-b"],["class","flex items-center space-x-4",4,"ngIf","ngIfElse"],[1,"flex-1","bg-white","p-6","space-y-4","overflow-y-auto",3,"scroll"],[4,"ngIf","ngIfElse"],["class","p-4 bg-gray-50 border-t flex items-center gap-4",4,"ngIf"],[1,"flex-1","overflow-hidden"],["class","flex items-center gap-3 p-2 mb-2 rounded cursor-pointer hover:bg-green-800 transition",3,"bg-green-800","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-3","p-2","mb-2","rounded","cursor-pointer","hover:bg-green-800","transition",3,"click"],["alt","Profile",1,"w-10","h-10","rounded-full","object-cover","border-2","border-white",3,"error","src"],[1,"font-semibold","text-white"],[1,"text-xs","text-gray-200"],[1,"text-sm","text-gray-300","mt-4"],[1,"flex","items-center","space-x-4"],[1,"text-xl","font-semibold","text-gray-700"],[1,"text-green-500","text-sm"],[1,"text-xl","font-semibold","text-gray-400"],["class","d-flex justify-content-center align-items-center my-20",4,"ngIf"],["class","text-gray-500",4,"ngIf"],[4,"ngIf"],[1,"d-flex","justify-content-center","align-items-center","my-20"],["role","status",1,"spinner-border","text-success"],[1,"visually-hidden"],[1,"text-gray-500"],[4,"ngFor","ngForOf"],["class","flex justify-end",4,"ngIf"],["class","flex justify-start",4,"ngIf"],[1,"flex","justify-end"],[1,"bg-green-600","text-white","px-4","py-2","rounded-lg","max-w-xs"],[1,"flex","justify-start"],[1,"bg-gray-200","text-gray-800","px-4","py-2","rounded-lg","max-w-xs"],[1,"text-gray-400"],[1,"p-4","bg-gray-50","border-t","flex","items-center","gap-4"],["type","text","placeholder","Type your message...",1,"flex-1","p-3","rounded-lg","border","border-gray-300","focus:outline-none","focus:ring-2","focus:ring-green-500",3,"ngModelChange","ngModel"],[1,"bg-green-600","text-white","px-4","py-2","rounded-lg","hover:bg-green-700","transition",3,"click"]],template:function(e,o){if(e&1){let a=x();s(0,"div",4)(1,"aside",5)(2,"h2",6),g(3,"Messages"),i(),s(4,"input",7),I("ngModelChange",function(u){return p(a),E(o.searchQuery,u)||(o.searchQuery=u),f(u)}),i(),d(5,J,2,1,"ul",8)(6,K,2,0,"ng-template",null,0,C),i(),s(8,"main",9)(9,"header",10),d(10,X,7,2,"div",11)(11,Y,2,0,"ng-template",null,1,C),i(),s(13,"section",12,2),_("scroll",function(){return p(a),f(o.onScroll())}),d(15,re,4,3,"ng-container",13)(16,oe,2,0,"ng-template",null,3,C),i(),d(18,ae,4,1,"footer",14),i()()}if(e&2){let a=y(7),m=y(12),u=y(17);r(4),S("ngModel",o.searchQuery),r(),l("ngIf",o.senderReceiverList.length>0)("ngIfElse",a),r(5),l("ngIf",o.selectedUser)("ngIfElse",m),r(5),l("ngIf",o.selectedUser)("ngIfElse",u),r(3),l("ngIf",o.selectedUser)}},dependencies:[D,F,N,P,Q,G,k],encapsulation:2})};export{H as MessageComponent};
