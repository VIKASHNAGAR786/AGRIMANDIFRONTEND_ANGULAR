import{a as q}from"./chunk-DVRKXUOX.js";import{b as G,d as k,g as P,r as W}from"./chunk-BVBPEAM6.js";import{g as $}from"./chunk-DGXWINA3.js";import{l as D,m as Q,q as j}from"./chunk-N7HDFMCH.js";import{Ab as E,Bb as I,Da as M,Ha as o,Ma as T,Nb as C,Ra as U,Wa as g,bb as c,cb as A,ea as p,eb as i,fa as f,fb as r,g as _,gb as S,hb as R,ib as V,jb as x,mb as v,nb as a,qb as B,rb as L,sb as F,tb as h,u as w,ub as m,vb as O,wb as y,xb as N,zb as b}from"./chunk-XGDP56UF.js";var z=["messagesContainer"];function J(t,n){if(t&1&&S(0,"img",21),t&2){let e=a().$implicit,s=a(2);c("src",`${s.BASE_URL}/${e.profileImageUrl}`,M)}}function K(t,n){if(t&1){let e=x();i(0,"li",17),v("click",function(){let l=p(e).$implicit,d=a(2);return f(d.selectUser(l))}),g(1,J,1,1,"img",18),i(2,"div")(3,"div",19),m(4),r(),i(5,"div",20),m(6),r()()()}if(t&2){let e=n.$implicit,s=a(2);A("bg-green-800",(s.selectedUser==null?null:s.selectedUser.messageId)===e.messageId),o(),c("ngIf",e.profileImageUrl),o(3),O(e.userName),o(2),N("",e.senderRole," \u2194 ",e.receiverRole,"")}}function X(t,n){if(t&1&&(i(0,"ul",15),g(1,K,7,6,"li",16),r()),t&2){let e=a();o(),c("ngForOf",e.filteredSenderReceiverList)}}function Y(t,n){t&1&&(i(0,"div",22),m(1,"No messages found."),r())}function Z(t,n){if(t&1&&(i(0,"div",23),S(1,"img",24),i(2,"div")(3,"h2",25),m(4),r(),i(5,"span",26),m(6,"\u25CF Online"),r()()()),t&2){let e=a();o(),c("src",`${e.BASE_URL}/${e.selectedUser.profileImageUrl}`,M),o(3),y(" ",e.selectedUser.userName," ")}}function ee(t,n){t&1&&(i(0,"h2",27),m(1,"Select a conversation"),r())}function te(t,n){if(t&1&&(i(0,"div",31)(1,"div",32),m(2),r()()),t&2){let e=a().$implicit;o(2),y(" ",e.sendmessage," ")}}function ne(t,n){if(t&1&&(i(0,"div",33)(1,"div",34),m(2),r()()),t&2){let e=a().$implicit;o(2),y(" ",e.receivemessage," ")}}function ie(t,n){if(t&1&&(i(0,"div"),g(1,te,3,1,"div",29)(2,ne,3,1,"div",30),r()),t&2){let e=n.$implicit;o(),c("ngIf",e.sendmessage),o(),c("ngIf",e.receivemessage)}}function re(t,n){if(t&1&&(R(0),g(1,ie,3,2,"div",28),V()),t&2){let e=a();o(),c("ngForOf",e.messages)}}function se(t,n){t&1&&(i(0,"div",35),m(1," No conversation selected "),r())}function oe(t,n){if(t&1){let e=x();i(0,"footer",36)(1,"input",37),I("ngModelChange",function(l){p(e);let d=a();return E(d.newMessage,l)||(d.newMessage=l),f(l)}),r(),i(2,"button",38),v("click",function(){p(e);let l=a();return f(l.onSendMessage())}),m(3,` Send
`),r()()}if(t&2){let e=a();o(),b("ngModel",e.newMessage)}}var H=class t{constructor(n){this.messageService=n}messagesContainer;autoScroll=!0;senderReceiverList=[];selectedUser=null;messages=[];newMessage="";searchQuery="";BASE_URL=$.BASE_URL;ngOnInit(){return _(this,null,function*(){yield this.loadSenderReceiverData()})}ngAfterViewInit(){this.scrollToBottom()}loadSenderReceiverData(){return _(this,null,function*(){try{this.senderReceiverList=yield w(this.messageService.GetAllSenderAndReceiverData())}catch(n){console.error("Error loading sender/receiver list",n)}})}selectUser(n){return _(this,null,function*(){if(this.selectedUser?.useridformessage!==n.useridformessage){this.selectedUser=n;try{this.messages=yield w(this.messageService.GetAllMessageUserBy(n.useridformessage)),this.onMessagesUpdated()}catch(e){console.error("Error loading messages for user",e)}}})}get filteredSenderReceiverList(){if(!this.searchQuery.trim())return this.senderReceiverList;let n=this.searchQuery.toLowerCase();return this.senderReceiverList.filter(e=>e.userName?.toLowerCase().includes(n))}onMessagesUpdated(){this.autoScroll&&this.scrollToBottom()}scrollToBottom(){try{requestAnimationFrame(()=>{this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight})}catch(n){console.error("Scroll failed",n)}}onScroll(){let n=this.messagesContainer.nativeElement,e=n.scrollHeight-n.scrollTop-n.clientHeight<50;this.autoScroll=e}onSendMessage(){if(!this.newMessage.trim()||!this.selectedUser)return;let n={mainuserid:this.selectedUser.useridformessage,messageText:this.newMessage};this.messageService.sendMessage(n).subscribe(e=>{e&&(console.log(e.message),this.messages.push({sendmessage:this.newMessage}),this.newMessage="")})}static \u0275fac=function(e){return new(e||t)(T(q))};static \u0275cmp=U({type:t,selectors:[["app-message"]],viewQuery:function(e,s){if(e&1&&B(z,5),e&2){let l;L(l=F())&&(s.messagesContainer=l.first)}},decls:19,vars:8,consts:[["noMessages",""],["noChatSelected",""],["messagesContainer",""],["emptyChat",""],[1,"flex","flex-col","md:flex-row","h-[calc(80vh-48px)]","bg-gray-100"],[1,"w-full","md:w-1/4","bg-green-700","text-white","p-5","flex","flex-col"],[1,"text-2xl","font-bold","mb-4"],["type","text","placeholder","Search by name or role...",1,"w-full","p-2","rounded","bg-green-600","text-white","placeholder-gray-300","focus:outline-none","focus:ring-2","focus:ring-yellow-300","mb-4",3,"ngModelChange","ngModel"],["class","flex-1 overflow-hidden",4,"ngIf","ngIfElse"],[1,"flex-1","flex","flex-col"],[1,"bg-white","p-4","shadow","flex","items-center","justify-between","border-b"],["class","flex items-center space-x-4",4,"ngIf","ngIfElse"],[1,"flex-1","bg-white","p-6","space-y-4","overflow-y-auto",3,"scroll"],[4,"ngIf","ngIfElse"],["class","p-4 bg-gray-50 border-t flex items-center gap-4",4,"ngIf"],[1,"flex-1","overflow-hidden"],["class","flex items-center gap-3 p-2 mb-2 rounded cursor-pointer hover:bg-green-800 transition",3,"bg-green-800","click",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-3","p-2","mb-2","rounded","cursor-pointer","hover:bg-green-800","transition",3,"click"],["alt","Profile","class","w-10 h-10 rounded-full object-cover border-2 border-white",3,"src",4,"ngIf"],[1,"font-semibold","text-white"],[1,"text-xs","text-gray-200"],["alt","Profile",1,"w-10","h-10","rounded-full","object-cover","border-2","border-white",3,"src"],[1,"text-sm","text-gray-300","mt-4"],[1,"flex","items-center","space-x-4"],["alt","User",1,"w-10","h-10","rounded-full","object-cover","border",3,"src"],[1,"text-xl","font-semibold","text-gray-700"],[1,"text-green-500","text-sm"],[1,"text-xl","font-semibold","text-gray-400"],[4,"ngFor","ngForOf"],["class","flex justify-end",4,"ngIf"],["class","flex justify-start",4,"ngIf"],[1,"flex","justify-end"],[1,"bg-green-600","text-white","px-4","py-2","rounded-lg","max-w-xs"],[1,"flex","justify-start"],[1,"bg-gray-200","text-gray-800","px-4","py-2","rounded-lg","max-w-xs"],[1,"text-center","text-gray-400","text-sm","mt-10"],[1,"p-4","bg-gray-50","border-t","flex","items-center","gap-4"],["type","text","placeholder","Type your message...",1,"flex-1","p-3","rounded-lg","border","border-gray-300","focus:outline-none","focus:ring-2","focus:ring-green-500",3,"ngModelChange","ngModel"],[1,"bg-green-600","text-white","px-4","py-2","rounded-lg","hover:bg-green-700","transition",3,"click"]],template:function(e,s){if(e&1){let l=x();i(0,"div",4)(1,"aside",5)(2,"h2",6),m(3,"Messages"),r(),i(4,"input",7),I("ngModelChange",function(u){return p(l),E(s.searchQuery,u)||(s.searchQuery=u),f(u)}),r(),g(5,X,2,1,"ul",8)(6,Y,2,0,"ng-template",null,0,C),r(),i(8,"main",9)(9,"header",10),g(10,Z,7,2,"div",11)(11,ee,2,0,"ng-template",null,1,C),r(),i(13,"section",12,2),v("scroll",function(){return p(l),f(s.onScroll())}),g(15,re,2,1,"ng-container",13)(16,se,2,0,"ng-template",null,3,C),r(),g(18,oe,4,1,"footer",14),r()()}if(e&2){let l=h(7),d=h(12),u=h(17);o(4),b("ngModel",s.searchQuery),o(),c("ngIf",s.senderReceiverList.length>0)("ngIfElse",l),o(5),c("ngIf",s.selectedUser)("ngIfElse",d),o(5),c("ngIf",s.selectedUser)("ngIfElse",u),o(3),c("ngIf",s.selectedUser)}},dependencies:[j,D,Q,W,G,k,P],encapsulation:2})};export{H as MessageComponent};
