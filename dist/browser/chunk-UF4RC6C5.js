import{a as K}from"./chunk-KOSC6SX4.js";import{a as Y,b as J}from"./chunk-AA542EW2.js";import{b as B,d as L,e as N,g as z,i as O,j as G,r as W,t as q}from"./chunk-AA32GII2.js";import{a as X}from"./chunk-VU24MND7.js";import{a as H}from"./chunk-NLJOITTN.js";import{a as Q}from"./chunk-GMVHBDDR.js";import{j as A,l as j}from"./chunk-6HB3LA7G.js";import{m as R,o as D,q as U}from"./chunk-5OO754BD.js";import{Ab as k,Cb as V,Db as E,Eb as M,Ga as P,Ka as l,Mb as T,Nb as F,Pa as p,Ua as I,Za as _,eb as v,ga as m,ha as u,hb as t,i as w,ia as S,ib as i,ja as y,jb as d,mb as h,pb as g,qb as c,xb as n,yb as f,za as C,zb as b}from"./chunk-SR3MDXF7.js";function $(s,a){s&1&&(t(0,"div",2)(1,"div",3)(2,"div",4),d(3,"div",5),t(4,"div",6),S(),t(5,"svg",7),d(6,"path",8),i()()(),y(),t(7,"p",9),n(8," \u{1F4E6} Loading your inventory... "),i(),t(9,"div",10),d(10,"div",11),i()()())}function ee(s,a){if(s&1&&(t(0,"div",49),n(1," Messaging "),t(2,"strong"),n(3),i()()),s&2){let e=c(3);l(3),f(e.farmermail_for_contact)}}function te(s,a){if(s&1){let e=h();t(0,"div",39),g("click",function(){m(e);let r=c(2);return u(r.showContactForm=!1)}),t(1,"div",40),g("click",function(r){return m(e),u(r.stopPropagation())}),t(2,"button",41),g("click",function(){m(e);let r=c(2);return u(r.showContactForm=!1)}),n(3," \xD7 "),i(),t(4,"h2",42),d(5,"i",43),n(6," Message Farmer "),i(),t(7,"form",44),g("ngSubmit",function(){m(e);let r=c(2);return u(r.sendMessage())}),_(8,ee,4,1,"div",45),t(9,"textarea",46),M("ngModelChange",function(r){m(e);let x=c(2);return E(x.message.MessageText,r)||(x.message.MessageText=r),u(r)}),i(),t(10,"button",47),d(11,"i",48),n(12," Send "),i()()()()}if(s&2){let e=c(2);l(8),v("ngIf",e.farmermail_for_contact),l(),V("ngModel",e.message.MessageText)}}function ie(s,a){if(s&1){let e=h();t(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15),d(4,"img",16),i(),t(5,"div",17)(6,"div",18)(7,"h1",19),n(8),i(),t(9,"p",20),n(10),i(),t(11,"div",21)(12,"span",22),n(13),i(),t(14,"span",23),n(15),i(),t(16,"span",24),n(17),i()(),t(18,"div",25)(19,"ul",26)(20,"li")(21,"strong"),n(22,"Quantity:"),i(),n(23),i(),t(24,"li")(25,"strong"),n(26,"Price per Unit:"),i(),t(27,"span",27),n(28),i()(),t(29,"li")(30,"strong"),n(31,"Total Price:"),i(),t(32,"span",28),n(33),i()(),t(34,"li")(35,"strong"),n(36,"Location:"),i(),n(37),i(),t(38,"li")(39,"strong"),n(40,"Harvest Date:"),i(),n(41),T(42,"date"),i()()(),t(43,"div",29)(44,"button",30),g("click",function(){m(e);let r=c();return u(r.buyProduct())}),d(45,"i",31),n(46," Buy Now "),i(),t(47,"button",32),g("click",function(){m(e);let r=c();return u(r.toggleContactForm())}),d(48,"i",33),n(49," Contact Farmer "),i(),t(50,"button",34),g("click",function(){m(e);let r=c();return u(r.viewProductPdf(r.selectedproduct.productid))}),d(51,"i",35),n(52," PDF "),i(),t(53,"button",36),g("click",function(){m(e);let r=c();return u(r.goBackToList())}),d(54,"i",37),n(55," Back "),i()()()()()(),_(56,te,13,2,"div",38),i()}if(s&2){let e=c();l(4),v("src",e.selectedproduct.imageUrl||"images/defaultproduct.webp",P)("alt",e.selectedproduct.name),l(4),f(e.selectedproduct.name),l(2),f(e.selectedproduct.description),l(3),f(e.selectedproduct.category),l(2),f(e.selectedproduct.grade),l(2),f(e.selectedproduct.status),l(6),k(" ",e.selectedproduct.quantity," ",e.selectedproduct.unit,""),l(5),b("\u20B9",e.selectedproduct.pricePerUnit,""),l(5),b("\u20B9",e.selectedproduct.totalPrice,""),l(4),b(" ",e.selectedproduct.location,""),l(4),b(" ",F(42,14,e.selectedproduct.harvestDate),""),l(15),v("ngIf",e.showContactForm)}}var Z=class s{constructor(a,e,o,r,x,re,ne,oe){this.productService=a;this.router=e;this.route=o;this.platformId=r;this.alertService=x;this.messageService=re;this.notificationservice=ne;this.userInfo=oe}BASE_URL=H.BASE_URL;selectedproduct=null;loading=!0;showContactForm=!1;farmermail_for_contact=null;message={farmerid:0,BuyerId:0,MessageText:"",RelatedProductId:0};ngOnInit(){this.checkAndLoadData()}checkAndLoadData(){this.route.params.subscribe(a=>{let e=a.productid;e&&this.loadProductDetails(+e)})}loadProductDetails(a){this.loading=!0,this.productService.GetProductById(a).subscribe({next:e=>{this.loading=!1,e.imageUrl!=null&&(console.log("\u{1F4E6} Product details loaded: before",e),e.imageUrl=`${this.BASE_URL}${e.imageUrl}`),this.selectedproduct=e||null,this.farmermail_for_contact=e.farmerEmail||null,console.log("\u{1F4E6} Product details loaded:",this.selectedproduct)},error:e=>{this.loading=!1,this.selectedproduct=null,this.alertService.showAlert("\u274C Error loading product details:",e)}})}sendMessage(){return w(this,null,function*(){yield this.notificationservice.GetUserRole().subscribe({next:a=>w(this,null,function*(){let e=a.data,o=0;if(e.role==="BUYER")o=e.roleid;else if(e.role==="FARMER"){o=e.roleid,yield this.alertService.showAlert("You are a farmer, you cannot send messages to Farmers.","error");return}let r=Number(this.userInfo.getUserId());this.message.BuyerId=r,this.message.farmerid=this.selectedproduct?.userId||0,this.message.RelatedProductId=this.selectedproduct?.productid||0,(yield this.messageService.ContactFarmer(this.message)).subscribe({next:x=>{this.alertService.showAlert("Message sent successfully!","success"),this.message.MessageText=""},error:x=>{this.alertService.showAlert("Error sending message:",x)}})}),error:a=>{this.alertService.showAlert("Error fetching user role:",a)}})})}viewProductPdf(a){this.productService.getProductPdf(a).subscribe({next:e=>{let o=new Blob([e],{type:"application/pdf"}),r=window.URL.createObjectURL(o);window.open(r,"_blank","noopener"),setTimeout(()=>URL.revokeObjectURL(r),5e3)},error:e=>{this.alertService.showAlert("Failed to load PDF:",e),this.alertService.showAlert("unable to open pdf please try again","error")}})}goBackToList(){this.router.navigate(["/products"])}toggleContactForm(){this.showContactForm=!this.showContactForm}buyProduct(){this.router.navigate(["/product-buy"])}static \u0275fac=function(e){return new(e||s)(p(J),p(j),p(A),p(C),p(Y),p(K),p(X),p(Q))};static \u0275cmp=I({type:s,selectors:[["app-single-product-view"]],decls:2,vars:2,consts:[["class","fixed inset-0 flex items-center justify-center bg-gradient-to-br from-green-900/80 via-black/80 to-green-950/80 backdrop-blur-md z-50",4,"ngIf"],["class","container my-8",4,"ngIf"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gradient-to-br","from-green-900/80","via-black/80","to-green-950/80","backdrop-blur-md","z-50"],[1,"flex","flex-col","items-center","space-y-8"],[1,"relative"],[1,"w-24","h-24","rounded-full","border-4","border-transparent","border-t-green-400","animate-spin"],[1,"absolute","inset-4","bg-gradient-to-br","from-green-500","to-green-600","rounded-lg","shadow-lg","flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","text-white","animate-bounce"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 7l9-4 9 4-9 4-9-4zM3 17l9 4 9-4M3 12l9 4 9-4"],[1,"text-green-100","text-xl","font-bold","tracking-wide","animate-pulse"],[1,"w-64","h-3","bg-green-900","rounded-full","overflow-hidden","shadow-inner"],[1,"h-full","bg-gradient-to-r","from-green-400","to-green-600","animate-[progressFill_2s_infinite]"],[1,"container","my-8"],[1,"card","shadow-xl","rounded-3xl","overflow-hidden","border-0"],[1,"row","g-0"],[1,"col-md-5"],[1,"img-fluid","h-100","w-100","object-cover",3,"src","alt"],[1,"col-md-7","p-5"],[1,"card-body"],[1,"text-3xl","font-bold","text-gray-900","mb-3"],[1,"text-gray-600","leading-relaxed","mb-4"],[1,"flex","flex-wrap","gap-2","mb-4"],[1,"px-3","py-1","rounded-full","text-sm","bg-blue-100","text-blue-700"],[1,"px-3","py-1","rounded-full","text-sm","bg-green-100","text-green-700"],[1,"px-3","py-1","rounded-full","text-sm","bg-yellow-100","text-yellow-700"],[1,"bg-gray-50","rounded-xl","p-4","shadow-sm","mb-5"],[1,"space-y-2","text-gray-700"],[1,"text-green-600","font-semibold"],[1,"text-green-700","font-bold","text-lg"],[1,"flex","flex-wrap","gap-3"],[1,"btn","btn-success","flex","items-center","gap-2","px-4","py-2",3,"click"],[1,"bi","bi-cart-check"],[1,"btn","btn-outline-primary","flex","items-center","gap-2","px-4","py-2",3,"click"],[1,"bi","bi-envelope"],[1,"btn","btn-outline-secondary","flex","items-center","gap-2","px-4","py-2",3,"click"],[1,"bi","bi-file-earmark-arrow-down"],[1,"btn","btn-outline-danger","flex","items-center","gap-2","px-4","py-2",3,"click"],[1,"bi","bi-arrow-left"],["class",`fixed inset-0 z-40 flex items-center justify-center 
    bg-black/60 backdrop-blur-sm`,3,"click",4,"ngIf"],[1,"fixed","inset-0","z-40","flex","items-center","justify-center","bg-black/60","backdrop-blur-sm",3,"click"],[1,"bg-white","rounded-2xl","shadow-2xl","max-w-lg","w-full","p-6","relative","animate-fadeIn",3,"click"],[1,"absolute","right-3","top-3","text-gray-400","hover:text-red-600","text-2xl","font-bold",3,"click"],[1,"text-xl","font-bold","text-green-700","mb-4","flex","items-center","gap-2"],[1,"bi","bi-chat-dots-fill"],[1,"space-y-4",3,"ngSubmit"],["class","text-sm text-gray-600 bg-gray-50 p-2 rounded-md",4,"ngIf"],["name","MessageText","required","","rows","5","placeholder","Write your message...",1,"w-full","p-3","rounded-lg","border","border-gray-300","focus:ring-2","focus:ring-green-500","shadow-sm",3,"ngModelChange","ngModel"],["type","submit",1,"w-full","bg-green-600","hover:bg-green-700","text-white","font-semibold","py-2.5","rounded-lg","shadow-md","flex","justify-center","items-center","gap-2"],[1,"bi","bi-send-fill"],[1,"text-sm","text-gray-600","bg-gray-50","p-2","rounded-md"]],template:function(e,o){e&1&&_(0,$,11,0,"div",0)(1,ie,57,16,"div",1),e&2&&(v("ngIf",o.loading),l(),v("ngIf",!o.loading&&o.selectedproduct))},dependencies:[U,R,D,q,G,B,L,N,W,O,z],styles:["@keyframes _ngcontent-%COMP%_progressFill{0%{width:0%}50%{width:70%}to{width:100%}}"]})};export{Z as SingleProductViewComponent};
